import{_ as T,r as f,a as H,b as u,o as J,z as Q,c as V,w as B,d as l,e as p,f as r,g as c,v as N,A as C,u as d,E as y,j as h,k as z,l as W,m as _,n as U,F as X,B as Y,p as Z,q as $,h as ee,i as te}from"./index.4e24e414.js";import{G as P}from"./GInput.b20708e8.js";import{c as ae}from"./index.c5067761.js";const le=k=>(Z("data-v-7cc2497b"),k=k(),$(),k),se={class:"wrapper"},ne={class:"container","element-loading-background":"rgba(255, 255, 255, 0.8)","element-loading-text":"\u6570\u636E\u52A0\u8F7D\u4E2D..."},oe=le(()=>p("div",{style:{margin:"50px 15px"}},[p("h1",{style:{"font-size":"40px","text-align":"center"}},"\u7B14\u8BB0\u7BA1\u7406\u7CFB\u7EDF")],-1)),re={class:"hit",style:{color:"#d93025"}},ie={class:"key-select"},ue={class:"hit",style:{color:"#d93025"}},ce={class:"ensure-container"},de={href:"/ui/skfdriver.msi"},pe={__name:"AdminLogin",setup(k){const g=f(!1),x=f(""),a=f(""),b=f(""),w=ee(),S=te(),o=H({username:!1,pin:!1}),s=f([]),E=()=>{if(x.value==""){h.error("\u7528\u6237\u540D\u4FE1\u606F\u4E3A\u7A7A");return}if(a.value==""){h.error("\u672A\u9009\u62E9\u8BBE\u5907");return}if(b.value==""){h.error("pin\u4E3A\u7A7A");return}g.value=!0,u.get("/api/random").then(e=>{var t={Rb:e.data,text3:x.value,pin:b.value,ukeyName:a.value,B:"dpm"};return u.post("http://127.0.0.1:28081/skf/ukey/eccEntityAuth",t)}).then(e=>u.post("/api/entityAuth",e.data)).then(e=>{S.commit("saveUserInfo",e.data),e.data.type=="admin"?w.push({name:"adminProject"}):e.data.type=="audit"&&w.push({name:"operationLog"})}).catch(e=>{h.error({message:e.response.data,duration:2e3,showClose:!0})}).finally(()=>{g.value=!1})},D=()=>{w.push({name:"binding"})},F=e=>{e!=""?o.username=!1:o.username=!0},j=e=>{e!=""?o.pin=!1:o.pin=!0},L=()=>{g.value=!0,u.get("http://127.0.0.1:28081/skf/ukey/enum").then(e=>{if(s.value=e.data,s.value.length>=1&&a.value=="")a.value=s.value[0].name;else if(s.value.length>=1&&a.value!=""){let t=!1;for(let m=0;m<s.value.length;m++)if(s.value[m].name==a.value){t=!0;break}t||(a.value=s.value[0].name)}else s.value.length==0&&(a.value="")}).catch(e=>{h.error({message:e.response.data,duration:2e3,showClose:!0})}).finally(()=>{g.value=!1})},I=f(!1),G=()=>{u.get("http://127.0.0.1:28081/skf/ukey/version",{timeout:300}).then(e=>{I.value=!0}).catch(()=>{})};let i=!1;const M=()=>{i&&(clearInterval(v),i=!1),ae("skfdriver://",()=>{h.error({message:"\u8BF7\u4E0B\u8F7D\u9A71\u52A8\u7A0B\u5E8F",duration:2e3,showClose:!0}),console.log("\u534F\u8BAE\u672A\u6CE8\u518C"),clearInterval(v),i=!1},()=>{console.log("\u534F\u8BAE\u5DF2\u6CE8\u518C"),i=!0},3e3),R()};let v=null;const R=()=>{v=setInterval(()=>{i=!0,u.get("http://127.0.0.1:28081/skf/ukey/version",{timeout:300}).then(()=>{I.value=!0,L(),clearInterval(v),i=!1}).catch(()=>{})},2*1e3)},A=setInterval(()=>{u.get("http://127.0.0.1:28081/skf/ukey/feed").then(e=>{}).catch(()=>{})},30*1e3);return J(()=>{G()}),Q(()=>{A&&clearInterval(A),v&&(clearInterval(v),i=!1)}),(e,t)=>{const m=z("el-icon"),q=z("el-option"),K=z("el-select"),O=W("loading");return _(),V("div",se,[B((_(),V("div",ne,[oe,l(P,{err:o.username,onBlur:F,modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=n=>x.value=n),placeholder:"\u7528\u6237\u540D"},null,8,["err","modelValue"]),B(p("div",re,[l(m,null,{default:r(()=>[l(d(U))]),_:1}),c("\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A ")],512),[[N,o.username]]),p("div",ie,[l(K,{modelValue:a.value,"onUpdate:modelValue":t[1]||(t[1]=n=>a.value=n),class:"list-select",placeholder:"\u8BBE\u5907",size:"large",clearable:"",style:{width:"75%"}},{default:r(()=>[(_(!0),V(X,null,Y(s.value,n=>(_(),C(q,{key:n.name,label:n.name,value:n.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),I.value==!1?(_(),C(d(y),{key:0,type:"info",size:"large",style:{"margin-left":"25px"},onClick:M},{default:r(()=>[c(" \u5237\u65B0 ")]),_:1})):(_(),C(d(y),{key:1,type:"info",size:"large",style:{"margin-left":"25px"},onClick:L},{default:r(()=>[c(" \u5237\u65B0 ")]),_:1}))]),l(P,{err:o.pin,onBlur:j,style:{"margin-top":"15px"},modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=n=>b.value=n),type:"password",placeholder:"PIN",onEnter:E},null,8,["err","modelValue"]),B(p("div",ue,[l(m,null,{default:r(()=>[l(d(U))]),_:1}),c("PIN\u4E0D\u80FD\u4E3A\u7A7A ")],512),[[N,o.pin]]),p("div",ce,[l(d(y),{onClick:E,size:"large",style:{"font-size":"16px",width:"100%"},type:"primary"},{default:r(()=>[c(" \u767B \u5F55 ")]),_:1}),l(d(y),{onClick:D,size:"large",style:{"font-size":"16px",width:"100%","margin-top":"30px","margin-left":"0px"},type:"primary"},{default:r(()=>[c(" \u7ED1\u5B9A ")]),_:1})]),p("a",de,[l(d(y),{link:"",class:"link-button"},{default:r(()=>[c(" \u4E0B\u8F7D\u9A71\u52A8\u7A0B\u5E8F ")]),_:1})])])),[[O,g.value]])])}}},he=T(pe,[["__scopeId","data-v-7cc2497b"]]);export{he as default};
