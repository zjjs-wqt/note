import{_ as Q,r as p,G as R,w as T,c as I,d as t,f as l,i as F,b as y,j as n,k as m,l as H,m as d,e as B,y as C,A as _,g as V,u as k,aQ as b,h as J}from"./index.4e24e414.js";const O={class:"user-body","element-loading-background":"rgba(255, 255, 255, 0.8)","element-loading-text":"\u6570\u636E\u52A0\u8F7D\u4E2D..."},W={class:"user-name"},X={key:1,style:{width:"30%"}},Y={key:1,style:{width:"30%"}},Z={style:{width:"30%"}},ee={__name:"User",setup(ae){const u=F(),x=J(),P=u.getters.getUserInfo,A=p(),a=p({name:u.getters.getUserInfo.name,username:u.getters.getUserInfo.username,oldPassword:"",newPassword:"",passwordAgain:"",phone:"",email:"",sn:""}),c=p(!1),g=p(!1),i=p(!1),$=p({oldPassword:[{required:!0,message:"\u8BF7\u8F93\u5165\u65E7\u53E3\u4EE4",trigger:"change"}],newPassword:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u53E3\u4EE4",trigger:"change"}],passwordAgain:[{required:!0,message:"\u8BF7\u518D\u6B21\u8F93\u5165\u65B0\u53E3\u4EE4",trigger:"change"}]}),U=()=>{let o=u.getters.getUserInfo.id;y.get("/api/user/info?userId="+o).then(e=>{a.value.phone=e.data.phone,a.value.email=e.data.email,a.value.sn=e.data.sn}).catch(e=>{n.error({message:e.response.data,duration:2e3,showClose:!0})})};U();const D=()=>{let o={};o.id=u.getters.getUserInfo.id,o.phone=a.value.phone,o.email=a.value.email,y.post("/api/user/edit",o).then(e=>{n.success({message:"\u7F16\u8F91\u6210\u529F",duration:2e3,showClose:!0}),U()}).catch(e=>{U(),n.error({message:e.response.data,duration:2e3,showClose:!0})})},j=()=>{if(a.value.newPassword!==a.value.passwordAgain){n.error({message:"\u4E24\u6B21\u8F93\u5165\u7684\u65B0\u53E3\u4EE4\u4E0D\u4E00\u81F4\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165",duration:2e3,showClose:!0});return}},S=()=>{A.value.validate(o=>{if(o){j();let e={};e.username=a.value.username,e.oldPwd=a.value.oldPassword,e.newPwd=a.value.newPassword,i.value=!0,y.post("/api/user/modifyPwd",e).then(s=>{n.success({message:"\u4FEE\u6539\u6210\u529F",duration:2e3,showClose:!0}),x.replace("/"),i.value=!1}).catch(s=>{i.value=!1,n.error({message:s.response.data,duration:2e3,showClose:!0})})}})},E=p({id:u.getters.getUserInfo.id,avatar:""}),f=p("");f.value=u.getters.getUserInfo.imgSrc;const q=(o,e)=>{if(o.raw.type!=="image/jpeg"&&o.raw.type!=="image/png")return n.error("\u5934\u50CF\u9700\u8981\u4E3Ajpeg\u6216png\u683C\u5F0F"),!1;if(o.raw.size/1024>64)return n.error("\u5934\u50CF\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC764KB"),!1;let s=new FormData;return s.append("avatar",o.raw),s.append("id",P.id),i.value=!0,y.post("/api/user/updateAvatar",s).then(v=>{f.value="/api/user/avatar?id="+P.id+"&r="+Math.random(),u.commit("saveImgSrc",f.value),n.success({message:"\u5934\u50CF\u4FEE\u6539\u6210\u529F",duration:2e3,showClose:!0})}).catch(v=>{n.error({message:v.response.data,duration:2e3,showClose:!0})}).finally(()=>{i.value=!1}),!0},M=(o,e)=>{if(o.raw.type!=="image/jpeg"&&o.raw.type!=="image/png")return n.error("\u5934\u50CF\u9700\u8981\u4E3Ajpeg\u6216png\u683C\u5F0F"),!1;if(o.raw.size/1024>64)return n.error("\u5934\u50CF\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC764KB"),!1;let s=new FormData;return s.append("avatar",o.raw),s.append("id",P.id),i.value=!0,y.post("/api/user/updateAvatar",s).then(v=>{f.value="/api/avatar?type=user&id="+P.id+"&r="+Math.random(),u.commit("saveImgSrc",f.value),n.success({message:"\u5934\u50CF\u4FEE\u6539\u6210\u529F",duration:2e3,showClose:!0})}).catch(v=>{n.error({message:v.response.data,duration:2e3,showClose:!0})}).finally(()=>{i.value=!1}),!0};return R(E.value,()=>{M()}),(o,e)=>{const s=m("el-form-item"),v=m("Plus"),N=m("el-icon"),z=m("el-image"),K=m("el-upload"),h=m("el-input"),w=m("el-button"),L=m("el-form"),G=H("loading");return T((d(),I("div",O,[t(L,{ref_key:"ruleForm",ref:A,model:a.value,rules:$.value,"label-width":"120px",class:"user-form"},{default:l(()=>[t(s,{label:"\u59D3\u540D",prop:"name"},{default:l(()=>[B("div",W,C(a.value.name),1)]),_:1}),t(s,{label:"\u5934\u50CF"},{default:l(()=>[t(K,{class:"avatar-uploader","auto-upload":!1,"on-change":q,"show-file-list":!1},{default:l(()=>[t(z,{src:f.value,class:"avatar",style:{width:"80px",height:"80px"}},{error:l(()=>[t(N,{class:"avatar-uploader-icon"},{default:l(()=>[t(v)]),_:1})]),_:1},8,["src"])]),_:1})]),_:1}),t(s,{label:"\u624B\u673A\u53F7",prop:"phone"},{default:l(()=>[c.value?(d(),_(h,{key:0,modelValue:a.value.phone,"onUpdate:modelValue":e[0]||(e[0]=r=>a.value.phone=r),style:{width:"30%"}},null,8,["modelValue"])):(d(),I("div",X,C(a.value.phone),1)),c.value?(d(),_(w,{key:2,icon:k(b),t:"",link:"",onClick:e[1]||(e[1]=r=>{c.value=!c.value,D()})},{default:l(()=>[V(" \u63D0\u4EA4")]),_:1},8,["icon"])):(d(),_(w,{key:3,icon:k(b),link:"",onClick:e[2]||(e[2]=r=>c.value=!c.value)},null,8,["icon"]))]),_:1}),t(s,{label:"\u90AE\u7BB1",prop:"email"},{default:l(()=>[g.value?(d(),_(h,{key:0,modelValue:a.value.email,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.email=r),style:{width:"30%"}},null,8,["modelValue"])):(d(),I("div",Y,C(a.value.email),1)),g.value?(d(),_(w,{key:2,icon:k(b),link:"",onClick:e[4]||(e[4]=r=>{g.value=!g.value,D()})},{default:l(()=>[V("\u63D0\u4EA4 ")]),_:1},8,["icon"])):(d(),_(w,{key:3,icon:k(b),link:"",onClick:e[5]||(e[5]=r=>g.value=!g.value)},null,8,["icon"]))]),_:1}),t(s,{label:"\u8EAB\u4EFD\u8BC1",prop:"sn"},{default:l(()=>[B("div",Z,C(a.value.sn),1)]),_:1}),t(s,{label:" \u65E7\u53E3\u4EE4",prop:"oldPassword"},{default:l(()=>[t(h,{modelValue:a.value.oldPassword,"onUpdate:modelValue":e[6]||(e[6]=r=>a.value.oldPassword=r),class:"user-password",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),t(s,{label:"\u65B0\u53E3\u4EE4",prop:"newPassword"},{default:l(()=>[t(h,{modelValue:a.value.newPassword,"onUpdate:modelValue":e[7]||(e[7]=r=>a.value.newPassword=r),class:"user-password",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),t(s,{label:"\u786E\u8BA4\u53E3\u4EE4",prop:"passwordAgain"},{default:l(()=>[t(h,{modelValue:a.value.passwordAgain,"onUpdate:modelValue":e[8]||(e[8]=r=>a.value.passwordAgain=r),class:"user-password",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),t(s,{class:"user-btn"},{default:l(()=>[t(w,{onClick:e[9]||(e[9]=r=>k(x).back())},{default:l(()=>[V("\u53D6\u6D88")]),_:1}),t(w,{type:"primary",onClick:e[10]||(e[10]=r=>S())},{default:l(()=>[V("\u786E\u8BA4\u4FEE\u6539")]),_:1})]),_:1})]),_:1},8,["model","rules"])])),[[G,i.value]])}}},oe=Q(ee,[["__scopeId","data-v-7338e71f"]]);export{oe as default};
