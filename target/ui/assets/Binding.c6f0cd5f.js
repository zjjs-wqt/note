import{_ as K,r as f,a as O,b as u,o as T,z as H,c as V,w as I,d as n,e as d,f as i,g as m,v as U,A as b,u as _,E as B,j as c,k as C,l as J,m as h,n as D,F as Q,B as W,p as X,q as Y,h as Z}from"./index.4e24e414.js";import{G as F}from"./GInput.b20708e8.js";import{c as $}from"./index.c5067761.js";const ee=k=>(X("data-v-26437f06"),k=k(),Y(),k),te={class:"wrapper"},ae={class:"container","element-loading-background":"rgba(255, 255, 255, 0.8)","element-loading-text":"\u6570\u636E\u52A0\u8F7D\u4E2D..."},le=ee(()=>d("div",{style:{margin:"50px 15px"}},[d("h1",{style:{"font-size":"40px","text-align":"center"}},"\u8BBE\u5907\u7ED1\u5B9A")],-1)),se={class:"hit",style:{color:"#d93025"}},ne={class:"key-select"},oe={class:"hit",style:{color:"#d93025"}},re={class:"ensure-container"},ue={href:"/ui/skfdriver.msi"},ie={__name:"Binding",setup(k){const g=f(!1),y=f(""),a=f(""),x=f(""),L=Z(),o=O({username:!1,pin:!1}),l=f([]),E=()=>{if(y.value==""){c.error("\u8D26\u6237\u4FE1\u606F\u4E3A\u7A7A");return}if(a.value==""){c.error("\u672A\u9009\u62E9\u8BBE\u5907");return}if(x.value==""){c.error("pin\u4E3A\u7A7A");return}g.value=!0,u.get("/api/random").then(e=>{var t={Rb:e.data,text3:y.value,pin:x.value,ukeyName:a.value,B:"dpm",needCert:!0};return u.post("http://127.0.0.1:28081/skf/ukey/eccEntityAuth",t)}).then(e=>u.post("/api/certBinding",e.data)).then(()=>{c.success({message:"\u8BBE\u5907\u7ED1\u5B9A\u6210\u529F",duration:2e3,showClose:!0}),L.push({name:"adminLogin"})}).catch(e=>{c.error({message:e.response.data,duration:2e3,showClose:!0})}).finally(()=>{g.value=!1})},z=()=>{g.value=!0,u.get("http://127.0.0.1:28081/skf/ukey/enum").then(e=>{if(l.value=e.data,l.value.length>=1&&a.value=="")a.value=l.value[0].name;else if(l.value.length>=1&&a.value!=""){let t=!1;for(let v=0;v<l.value.length;v++)if(l.value[v].name==a.value){t=!0;break}t||(a.value=l.value[0].name)}else l.value.length==0&&(a.value="")}).catch(e=>{c.error({message:e.response.data,duration:2e3,showClose:!0})}).finally(()=>{g.value=!1})},w=f(!1),P=()=>{u.get("http://127.0.0.1:28081/skf/ukey/version",{timeout:300}).then(e=>{w.value=!0}).catch(()=>{})};let r=!1;const S=()=>{r&&(clearInterval(p),r=!1),$("skfdriver://",()=>{c.error({message:"\u8BF7\u4E0B\u8F7D\u9A71\u52A8\u7A0B\u5E8F",duration:2e3,showClose:!0}),console.log("\u534F\u8BAE\u672A\u6CE8\u518C"),clearInterval(p),r=!1},()=>{console.log("\u534F\u8BAE\u5DF2\u6CE8\u518C"),r=!0},3e3),A()};let p=null;const A=()=>{p=setInterval(()=>{r=!0,u.get("http://127.0.0.1:28081/skf/ukey/version",{timeout:300}).then(()=>{w.value=!0,z(),clearInterval(p),r=!1}).catch(()=>{})},2*1e3)},N=setInterval(()=>{u.get("http://127.0.0.1:28081/skf/ukey/feed").then(e=>{}).catch(()=>{})},30*1e3),G=e=>{e!=""?o.username=!1:o.username=!0},M=e=>{e!=""?o.pin=!1:o.pin=!0};return T(()=>{P()}),H(()=>{N&&clearInterval(N),p&&(clearInterval(p),r=!1)}),(e,t)=>{const v=C("el-icon"),R=C("el-option"),j=C("el-select"),q=J("loading");return h(),V("div",te,[I((h(),V("div",ae,[le,n(F,{err:o.username,onBlur:G,modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=s=>y.value=s),placeholder:"\u7528\u6237\u540D"},null,8,["err","modelValue"]),I(d("div",se,[n(v,null,{default:i(()=>[n(_(D))]),_:1}),m("\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A ")],512),[[U,o.username]]),d("div",ne,[n(j,{modelValue:a.value,"onUpdate:modelValue":t[1]||(t[1]=s=>a.value=s),class:"list-select",placeholder:"\u8BBE\u5907",size:"large",clearable:"",style:{width:"75%"}},{default:i(()=>[(h(!0),V(Q,null,W(l.value,s=>(h(),b(R,{key:s.name,label:s.name,value:s.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),w.value==!1?(h(),b(_(B),{key:0,type:"info",size:"large",style:{"margin-left":"25px"},onClick:S},{default:i(()=>[m(" \u5237\u65B0 ")]),_:1})):(h(),b(_(B),{key:1,type:"info",size:"large",style:{"margin-left":"25px"},onClick:z},{default:i(()=>[m(" \u5237\u65B0 ")]),_:1}))]),n(F,{err:o.pin,onBlur:M,style:{"margin-top":"15px"},modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=s=>x.value=s),type:"password",placeholder:"PIN",onEnter:E},null,8,["err","modelValue"]),I(d("div",oe,[n(v,null,{default:i(()=>[n(_(D))]),_:1}),m("PIN\u4E0D\u80FD\u4E3A\u7A7A ")],512),[[U,o.pin]]),d("div",re,[n(_(B),{onClick:E,size:"large",style:{"font-size":"16px",width:"100%"},type:"primary"},{default:i(()=>[m(" \u7ED1\u5B9A ")]),_:1})]),d("a",ue,[n(_(B),{link:"",class:"link-button"},{default:i(()=>[m(" \u4E0B\u8F7D\u9A71\u52A8\u7A0B\u5E8F ")]),_:1})])])),[[q,g.value]])])}}},ve=K(ie,[["__scopeId","data-v-26437f06"]]);export{ve as default};
